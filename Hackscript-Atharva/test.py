import cv2
import pytesseract
from pytesseract import Output

img = cv2.imread('0000062.png')

d = pytesseract.image_to_data(img, output_type=Output.DICT)

n_boxes = len(d['text'])

font = cv2.FONT_HERSHEY_SIMPLEX
font_size = 0.5

ver_cluster=[1, 2, 3, 1, 2, 3, 1, 2, 4, 3, 5, 6, 7, 5, 8, 6, 7, 8, 6, 7, 9, 5, 8, 10, 11, 6, 12, 9, 13, 14, 13, 14, 13, 15, 13, 16, 15, 17, 17, 18, 19, 17, 17, 17, 20, 21, 22, 23, 24, 17, 20, 21, 22, 22, 23, 17, 20, 21, 25, 26, 26, 25, 26, 26, 27, 28, 29, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 36, 35, 37, 35, 37, 35, 37, 35, 37, 38, 35, 35, 37, 25]
hor_cluster=[1, 1, 1, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 4, 4, 5, 5, 6, 7, 8, 8, 8, 9, 10, 10, 10, 11, 12, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 12, 12, 12, 13, 13, 14, 14, 15, 15, 19, 19, 20, 20, 20, 20, 21]
coordin=[(55, 120), (92, 120), (143, 120), (56, 154), (87, 154), (134, 154), (55, 172), (83, 172), (117, 172), (138, 172), (55, 240), (274, 240), (313, 240), (55, 266), (86, 265), (273, 266), (304, 265), (100, 283), (274, 284), (305, 284), (359, 284), (55, 302), (83, 302), (117, 302), (138, 302), (274, 302), (342, 302), (365, 302), (463, 240), (528, 240), (463, 266), (529, 266), (456, 285), (637, 293), (463, 319), (499, 319), (633, 320), (54, 363), (57, 390), (186, 390), (566, 387), (54, 446), (55, 481), (56, 514), (125, 514), (157, 514), (182, 516), (208, 514), (243, 514), (55, 543), (125, 543), (153, 544), (173, 543), (188, 543), (222, 545), (55, 572), (125, 572), (160, 572), (54, 885), (112, 885), (127, 885), (55, 928), (108, 928), (120, 928), (145, 928), (182, 928), (198, 928), (55, 964), (97, 964), (131, 964), (174, 964), (221, 965), (239, 964), (268, 964), (309, 964), (448, 482), (488, 481), (630, 481), (495, 505), (659, 514), (503, 534), (665, 543), (500, 563), (666, 572), (476, 608), (659, 617), (438, 644), (473, 644), (497, 644), (672, 644), (55, 1005)]

sum=0
for i in range (n_boxes):
    relu=  max(0, int(d['conf'][i]))
    sum= sum+relu

sum= sum//n_boxes
print(sum)
for i in range(n_boxes):
    if int(d['conf'][i]) >sum:
        (x, y, w, h) = (d['left'][i], d['top'][i], d['width'][i], d['height'][i])
        img = cv2.rectangle(img, (x, y), (x + w, y + h), (0, 255, 0), 2)
        


for i in range(len(hor_cluster)):
    img= cv2.putText(img, str(ver_cluster[i]),coordin[i], font, font_size, (0, 0, 255), 1)
# cv2.imshow('img', img)
# cv2.waitKey(0)
cv2.imwrite('boxed.jpg', img)


print(d.keys())
# print(d['text'])
print(d)

print("\n")
print(len(d['text']))
print(len(d['level']))
print((d['conf']))




